<div class="panel panel-success">
    <div class="panel-body bg-success">
        <% if current_user && @sheet.uploaded_by?(current_user) %>
            <%= render 'edit_sheet_button' %>
        <% elsif current_user && @sheet.purchased_by?(current_user) %>
            <span class="sheet-price text-center"><p><span class="glyphicon glyphicon-ok"></span> PURCHASED</p></span>
        <% elsif @sheet.is_free? %>
            <span class="sheet-price text-center"><p><span class="glyphicon glyphicon-ok"></span> FREE</p></span>
        <% elsif current_user.nil? %>
            <span class="sheet-price col-xs-4"><p><%= "$#{@sheet.price}" %></p></span>
            <a href="<%= new_user_session_path %>"><button type="button" class="btn btn-success btn-lg col-xs-8"><span class="glyphicon glyphicon-shopping-cart"></span> Buy Now</button></a>
        <% else %>
            <span class="sheet-price col-xs-4"><p><%= "$#{@sheet.price}" %></p></span>
            <a data-toggle="modal" data-target="#buyNowModal"><button type="button" class="btn btn-success btn-lg col-xs-8">Buy Now</button></a>
        <% end %>
    </div>
</div>

<div class="modal fade" id="buyNowModal" role="dialog" aria-labelledby="flagModal" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <button id="modal-close-btn" type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="flagModal">Buy '<%= link_to @sheet.title, @sheet %>' for <%= "$#{@sheet.price}" %></h4>
      </div>
      <div class="modal-body">
        <p class="bg-info"><span class="glyphicon glyphicon-thumbs-up"></span> You're one step away from <strong>Unlimited Access</strong> to <%= @sheet.title %></p>

        <p class="text-center"><em>You will receive:</em></p>
        <ul id="sheet-files">
            <!-- Main PDF file -->
            <% if @sheet.pdf.present? %>
            <li>
                <p><span class="glyphicon glyphicon-save"></span><strong> <%= @sheet.pdf_file_name %></strong> (<%= number_to_human_size(@sheet.pdf_file_size) %>)</p>
            </li>
            <% else %>
            <li>
                <p class="bg-danger"><span class="glyphicon glyphicon-eye-close"></span> No PDF File Found.</p>
            </li>
            <% end %>

            <!-- Additional files -->
            <% for asset in @sheet.assets %>
            <li>
                <p><span class="glyphicon glyphicon-save"></span><strong> <%= asset.filename %></strong>(<%= number_to_human_size(asset.filesize) %>)</p>
            </li>
            <% end %>
            </ul>

        <hr>
        <strong>What happens next?</strong>
        <p>You'll be able to view and print all of your purchased sheet music anytime, on any platform and device - without ever paying again. And we'll send you an email receipt containing your full purchase details. Enjoy! </p>

      </div>
      <div id="loading-content" class="hidden">
          <%= image_tag "loading.gif", class: "center-block" %>
      </div>
      <div class="modal-footer">
          <%= image_tag("https://www.paypalobjects.com/webstatic/en_SG/mktg/Logos/AM_SbyPP_mc_vs_dc_ae.jpg", class:"paypal-logo") %>
          <a id="paypal-checkout-btn" href="<%= checkout_path(:sheet => @sheet) %>" data-method="post"><button type="button" class="btn btn-success"><span class="glyphicon glyphicon-shopping-cart"></span> Checkout with Paypal</button></a>
      </div>
    </div>
  </div>
</div>